import{u as T,d as j,r as w,i as $,a as b,b as R,c as t,e as S,j as N,f as e,C as I,A as q,I as L,g as U,L as E,h as A,k as O,l as W,m as M,s as B,n as F,o as k,p as V,q as z}from"./index-d5ffd54a.js";const H=()=>T(j),P="_container_1f313_107",Q={container:P},G="_container_1irw8_107",J="_UsersSearch_1irw8_114",K="_title_1irw8_117",y={container:G,UsersSearch:J,title:K};var D={},X=$;Object.defineProperty(D,"__esModule",{value:!0});var x=D.default=void 0,Y=X(w()),Z=b,ee=(0,Y.default)((0,Z.jsx)("path",{d:"M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"SearchRounded");x=D.default=ee;const se=({})=>{const{control:s,watch:n,handleSubmit:i}=R(),[l,a]=t.useState(!1),[C,_]=t.useState([]),[p,c]=t.useState(""),d=S(),f=(o,v)=>{c(v)},h=o=>{console.log("submit"),m(o.query)},m=async o=>{if(o){a(!0);const v=await U.getUsersByQuery(o);a(!1),v&&_(v.map(u=>({fullName:u.fullName,uid:u.uid})))}};return t.useEffect(()=>{console.log("query changed"),p&&m(p)},[p]),N("div",{className:y.UsersSearch,children:[e("h3",{className:y.title,children:"Знайдіть нових співрозмовників"}),e("form",{className:y.form,onSubmit:i(h),children:e(I,{control:s,name:"query",render:({field:{value:o,onChange:v}})=>e(q,{options:C,className:y.input,inputValue:p,freeSolo:!0,loading:l,loadingText:"Пошук...",isOptionEqualToValue:(u,g)=>u.fullName===g.fullName,getOptionLabel:u=>u.fullName,onChange:(u,g)=>{d(`/account/${g.uid}`)},onInputChange:f,placeholder:"І'мя та прізвище",endDecorator:e(L,{className:y.iconBtn,type:"submit",children:e(x,{className:y.icon})})})})})]})},te="_container_1f313_107",ae={container:te},ne="_container_1sn0j_107",ce="_ChatCard_1sn0j_114",oe="_avatar_1sn0j_133",re="_body_1sn0j_138",ie="_top_1sn0j_142",le="_contactName_1sn0j_148",ue="_lastMessageTime_1sn0j_151",de="_lastMessage_1sn0j_151",fe="_senderName_1sn0j_174",he="_text_1sn0j_177",me="_newMessagesCount_1sn0j_182",r={container:ne,ChatCard:ce,avatar:oe,body:re,top:ie,contactName:le,lastMessageTime:ue,lastMessage:de,senderName:fe,text:he,newMessagesCount:me},ge=s=>{const n=new Date,i=n.getTime(),l=s.getTime(),a=i-l,C=Math.floor(a/1e3/60),_=Math.floor(C/60);console.log("hoursDiff",_),console.log("message datee",s);const c=n.getHours()-_>0;console.log("is today",c);const d=1e3*60*60*24,f=d*7;return c?`${s.getHours()}:${s.getMinutes()}`:!c&&a<2*d?"Вчора":a>d&&a<=f-d?["Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота","Неділя"][s.getDay()]:O(l)},_e=({data:s})=>{const{contactAvatarUrl:n,contactFullname:i,contactId:l,lastMessageData:a,lastMessageTime:C}=s,[_,p]=t.useState(!1),[c,d]=t.useState(void 0),f=t.useRef(null),h=t.useRef(null),m=t.useRef(null),o=t.useRef(null);t.useEffect(()=>{if(h.current&&m.current&&o.current){const g=h.current.offsetWidth-m.current.offsetWidth-o.current.offsetWidth;console.log("width",g),d(g)}},[h.current,m.current,o.current]),t.useEffect(()=>{if(c&&f.current){const g=f.current.offsetWidth>c;p(g)}},[c,f.current]),H();const v=C.seconds?new Date(C.seconds*1e3):new Date,u=ge(v);return console.log("is cut",_),N(E,{to:`/chat/${l}`,className:r.ChatCard,children:[e(A,{src:n,className:r.avatar}),N("div",{className:r.body,children:[N("div",{className:r.top,children:[e("div",{className:r.contactName,children:i}),e("div",{className:r.lastMessageTime,children:u})]}),N("div",{className:r.lastMessage,ref:h,children:[N("p",{className:r.text,ref:f,style:{maxWidth:`${c}px`},children:[a.text,"fgdgdgdhg ndfsuy gifudguysdfogydfyigiunvfbygvniofsguyn",_&&e("span",{className:r.ending,children:"..."})]}),e("span",{className:r.newMessagesCount,ref:m,children:"0"})]})]})]})},pe=({chatsData:s})=>e("div",{className:ae.ChatsList,children:s.map(n=>e(_e,{data:n},n.contactId))}),ve=({})=>{const s=S(),n=W(),i=M(B),l=M(F),a=M(k);return t.useEffect(()=>{n(V())},[i==null?void 0:i.uid]),a||s("/login",{replace:!0}),N("div",{className:z(Q.Chats,"container"),children:[e(se,{}),l?e(pe,{chatsData:l}):e("p",{children:"Немає розмов"})]})},Ce=ve;export{Ce as default};
