"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[519],{15519:function(e,s,n){n.r(s),n.d(s,{default:function(){return Be}});var t=n(29439),a=n(72791),o=n(76910),r=n(16871),i=n(71269),c=n(74165),l=n(15861),u=n(93433),d=n(59434),g=n(44019),m=function(e){return e.messages.messagesData},f=function(e){return e.messages.isFetching},v=function(e){return e.messages.currMessageWhoReadList},h=n(84086),_=n(1413),x={container:"Message_container__98ggQ",contextMenu:"Message_contextMenu__5nXSb",menuItem:"Message_menuItem__H05HU",deleteMessage:"Message_deleteMessage__EwuNn",Message:"Message_Message__F164D",avatar:"Message_avatar__Caopz",messageBody:"Message_messageBody__OUWWq",username:"Message_username__fxinM",text:"Message_text__WoS5w",info:"Message_info__RJA5K",createDate:"Message_createDate__xMQe3",receivedStatus:"Message_receivedStatus__bfpZ1",icon:"Message_icon__heZ9C",edited:"Message_edited__g3pCJ",_my:"Message__my__ylldE"},p=n(38693),Z=n(19348),j=n(79817),M=n(56881),N=n(97788),w=n(80184),D=N.Z.Text,C=function(e){var s=e.showDeleteConfirm,n=e.className,t=e.messageId;return(0,w.jsx)(D,{onClick:function(){return s(t)},type:"danger",className:n,children:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"})},S=n(6886),y=n(45570),R=n(4407),b=n(78277),E=n(69407),B=n(81694),U=n.n(B),k=n(3404),W=n(38022),F=a.forwardRef((function(e,s){var n=e.messageData,t=e.myAccountId,o=e.showDeleteConfirm,r=e.setEditMessageData,i=e.openInfoModal,c=e.isShort,l=n.text,u=(n.photoUrl,n.uid),d=n.id,g=n.usersWhoRead,m=n.createdAt,f=n.displayName,v=n.received,h=n.edited,N=(0,a.useRef)(null),D=(0,Z.YD)({threshold:.7}),B=D.ref,F=D.inView,H=(D.entry,(0,j.T)());F&&!g.includes(t)&&H((0,M.RC)(d,t));var I=u===t,V=1e3*(null===m||void 0===m?void 0:m.seconds),T=new Date(V||(new Date).getTime()),L="".concat((0,p.v)(T.getHours()),":").concat((0,p.v)(T.getMinutes()));return(0,w.jsx)("div",{className:"".concat(x.Message," ").concat(I&&x._my),ref:B,children:(0,w.jsx)(S.ZP,{variant:"popover",popupId:"message-context",children:function(e){return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",(0,_.Z)((0,_.Z)({},(0,y.vW)(e)),{},{className:x.messageBody,ref:s,children:[!c&&!I&&(0,w.jsx)("h5",{className:x.username,children:f}),(0,w.jsx)("p",{className:x.text,children:l}),(0,w.jsxs)("div",{className:x.info,children:[h&&(0,w.jsx)("p",{className:x.edited,children:"\u0417\u043c\u0456\u043d\u0435\u043d\u043e"}),(0,w.jsx)("p",{className:x.createDate,children:L}),I&&(0,w.jsx)("p",{className:x.receivedStatus,children:v?(0,w.jsx)(k.Z,{className:x.icon}):(0,w.jsx)(W.Z,{className:x.icon})})]})]})),(0,w.jsx)(R.ZP,(0,_.Z)((0,_.Z)({},(0,y.ZW)(e)),{},{onClick:function(s){s.target===N.current||e.close()},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,w.jsxs)(b.Z,(0,_.Z)((0,_.Z)({},(0,y.wK)(e)),{},{ref:N,className:x.contextMenu,children:[I&&(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(E.Z,{onClick:function(){r({value:l,id:d})},className:x.menuItem,children:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438"})}),(0,w.jsx)(E.Z,{onClick:function(){i(g)},className:x.menuItem,children:"\u0406\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u044f"}),I&&(0,w.jsx)(E.Z,{className:x.deleteBtn,children:(0,w.jsx)(C,{className:U()(x.deleteMessage,x.menuItem),showDeleteConfirm:o,messageId:n.id})})]}))}))]})}})})})),H="Messages_Messages__9VokZ",I="Messages_messagesDate__8PYdw",V={container:"ReadMessageUser_container__tq+2i",ReadMessageUser:"ReadMessageUser_ReadMessageUser__Xtepz",name:"ReadMessageUser_name__tWFva"},T=n(23346),L=n(29529),A=function(e){var s=e.userData,n=s.name,t=s.surname,a=s.avatarUrl;return(0,w.jsxs)("div",{className:V.ReadMessageUser,children:[(0,w.jsx)(T.Z,{className:V.avatar,src:a,icon:(0,w.jsx)(L.Z,{}),size:50}),(0,w.jsxs)("p",{className:V.name,children:[n," ",t]})]})},q=n(43504),z="MessagesGroup_MessagesGroup__ivC4C",O="MessagesGroup_avatar__9Zunw",G="MessagesGroup_messages__yt51U",P=n(22622),K=function(e){var s,n,t=e.metadata,a=e.children;e.listRef;return(0,w.jsxs)("div",{className:z,children:[!t.isMy&&(0,w.jsx)("div",{className:O,children:(0,w.jsx)(q.rU,{to:"/account/".concat((null===(s=t.avatarData)||void 0===s?void 0:s.uid)||""),children:(0,w.jsx)(P.Z,{src:(null===(n=t.avatarData)||void 0===n?void 0:n.photoUrl)||void 0,className:O})})}),(0,w.jsx)("div",{className:G,children:a})]})},Q=n(69871),X=n(58195),Y=n(40464),J=n(77248),$=function(e){var s=e.target,n=e.isShow,t=(e.onCancel,e.onDelete),a=e.onClose;return(0,w.jsxs)(X.Z,{open:n,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,w.jsx)(Y.Z,{id:"alert-dialog-title",children:"\u0412\u0438 \u0434\u0456\u0439\u0441\u043d\u043e \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0438\u0434\u0430\u043b\u0438\u0442\u0438 ".concat(s,"?")}),(0,w.jsxs)(J.Z,{children:[(0,w.jsx)(Q.Z,{variant:"outlined",onClick:function(){a()},children:"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438"}),(0,w.jsx)(Q.Z,{variant:"outlined",color:"danger",onClick:function(){t(),a()},autoFocus:!0,children:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"})]})]})},ee=n(45987),se={container:"UsersWhoReadDialog_container__LZgNt",Dialog:"UsersWhoReadDialog_Dialog__1UcLq",dialogTitle:"UsersWhoReadDialog_dialogTitle__-O4ke",content:"UsersWhoReadDialog_content__lR5ig",closeBtn:"UsersWhoReadDialog_closeBtn__03VaO"},ne=n(60277),te=n(8440),ae=n(13811),oe=n(29823),re=["children","onClose"],ie=(0,ne.ZP)(X.Z)((function(e){var s=e.theme;return{"& .MuiDialogContent-root":{padding:s.spacing(2)},"& .MuiDialogActions-root":{padding:s.spacing(1)}}})),ce=function(e){var s=e.children,n=e.onClose,t=(0,ee.Z)(e,re);return(0,w.jsxs)(Y.Z,(0,_.Z)((0,_.Z)({sx:{m:0,p:2}},t),{},{className:se.dialogTitle,children:[s,n?(0,w.jsx)(ae.Z,{"aria-label":"close",onClick:n,className:se.closeBtn,sx:{position:"absolute",right:8,top:8},children:(0,w.jsx)(oe.Z,{className:se.icon})}):null]}))},le=function(e){var s=e.children,n=e.onClose,t=e.isOpen;return(0,w.jsxs)(ie,{onClose:n,"aria-labelledby":"customized-dialog-title",open:t,className:se.Dialog,children:[(0,w.jsx)(ce,{id:"customized-dialog-title",onClose:n,children:"\u041f\u0435\u0440\u0435\u0433\u043b\u044f\u043d\u0443\u043b\u0438"}),(0,w.jsx)(te.Z,{dividers:!0,className:se.content,children:s})]})},ue=n(763),de=n(45861),ge=a.forwardRef((function(e,s){var n=e.setEditMessageData,o=e.messagesData,r=(0,d.v9)(f),i=(0,d.v9)(g.Vi),m=(0,d.v9)(v),_=(0,a.useState)(null),x=(0,t.Z)(_,2),p=x[0],Z=x[1],N=(0,a.useState)(!1),D=(0,t.Z)(N,2),C=(D[0],D[1]),S=(0,a.useState)(null),y=(0,t.Z)(S,2),R=y[0],b=y[1],E=(0,a.useState)(o),B=(0,t.Z)(E,2),U=(B[0],B[1],(0,a.useState)([])),k=(0,t.Z)(U,2),W=(k[0],k[1]),V=(0,a.useState)(null),T=(0,t.Z)(V,2),L=T[0],q=T[1],z=(0,a.useRef)(null),O=(0,a.useRef)(null),G=(0,j.T)(),P=function(e){q(e)},Q=function(){q(null)};(0,a.useEffect)((function(){var e,s=function(){console.log("onscroll")};return null===(e=z.current)||void 0===e||e.addEventListener("scroll",(0,ue.debounce)(s,100)),function(){var e;null===(e=z.current)||void 0===e||e.removeEventListener("scroll",s)}}),[z.current]),(0,a.useEffect)((function(){O.current&&O.current.scrollIntoView({behavior:"auto"})}),[O.current]),(0,a.useEffect)((function(){var e=[],s=function(e){var s={};return e.forEach((function(e){var n,t=1e3*(null===(n=e.createdAt)||void 0===n?void 0:n.seconds),a=(0,de.g)(t||(new Date).getTime());s[a]||(s[a]=[]),s[a].push(e)})),s}(o);Object.keys(s).forEach((function(t){var a,o=-1,r=[],c=[];s[t].map((function(e,a){var l=(a>0?s[t][a-1].uid:null)==e.uid,d=e.uid===(null===i||void 0===i?void 0:i.uid)||null,g=(0,w.jsx)(F,{messageData:e,myAccountId:(null===i||void 0===i?void 0:i.uid)||"",setEditMessageData:n,showDeleteConfirm:P,openInfoModal:Z,isShort:l,ref:O},"".concat(e.createdAt).concat(e.uid));d&&(c=[].concat((0,u.Z)(c),[g])),l?r[o].messages.push(g):(d?r.push({messages:[g],metadata:{isMy:!0}}):(r.push({messages:[],metadata:{isMy:!1,avatarData:{photoUrl:e.photoUrl,uid:e.uid}}}),r[o+1].messages.push(g)),o++)})),a=r.map((function(e){return(0,w.jsx)(K,{metadata:e.metadata,listRef:z,children:e.messages})}));var l=[(0,w.jsx)("div",{className:I,children:t})].concat((0,u.Z)(a));W((function(e){return[].concat((0,u.Z)(e),(0,u.Z)(c))})),e=[].concat((0,u.Z)(e),(0,u.Z)(l))})),b(e)}),[i,o]),(0,a.useEffect)((function(){var e=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=5;break}return C(!0),e.next=4,G((0,M.Zi)(p));case 4:C(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[p]);var X=[];m&&m.forEach((function(e){X.push((0,w.jsx)(A,{userData:e}))}));return i?(0,w.jsxs)("div",{className:H,ref:z,children:[r&&(0,w.jsx)(h.Z,{}),(0,w.jsx)(le,{isOpen:!!p,onClose:function(){Z(null)},children:X||"\u0412\u0430\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u043d\u0456\u0445\u0442\u043e \u043d\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0432"}),(0,w.jsx)($,{target:"\u0446\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",isShow:!!L,onCancel:Q,onDelete:function(){L&&G((0,M.$Z)(L))},onClose:Q}),R&&R.length>0?R:(0,w.jsx)("div",{children:"\u041d\u0435\u043c\u0430\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c"})]}):(0,w.jsx)(h.Z,{})})),me=ge,fe="Chat_Chat__qtwg3",ve=n(21686),he={container:"NewMessageForm_container__uLUsq",NewMessageForm:"NewMessageForm_NewMessageForm__yn-Kq",textareaWrap:"NewMessageForm_textareaWrap__2SAy-"},_e=n(9062),xe=n(61134),pe=n(62902),Ze=n(29784),je=n(25370),Me=n(97310),Ne=n(4655),we=a.memo((function(e){var s=e.authData,n=e.isMessageEdit,o=e.currValue,r=e.updateMessage,i=e.scrollBottomBtn,u=(0,xe.cI)(),m=u.control,f=u.formState,v=f.errors,h=(f.isValid,u.handleSubmit),_=u.reset,x=u.setValue,p=u.trigger,Z=u.watch,N=(0,a.useState)(!1),D=(0,t.Z)(N,2),C=(D[0],D[1]),S=(0,a.useState)(!1),y=(0,t.Z)(S,2),R=(y[0],y[1],(0,a.useState)(!0)),b=(0,t.Z)(R,2),E=b[0],B=b[1],U=(0,a.useState)(!1),k=(0,t.Z)(U,2),W=k[0],F=k[1],H=(0,a.useState)(null),I=(0,t.Z)(H,2),V=I[0],T=I[1],L=(0,d.v9)(g.Vi),A=(0,a.useRef)(null),q=(0,a.useRef)(null);(0,a.useEffect)((function(){A.current&&(T(A.current.querySelector("textarea")),console.log("set textareaEl"))}),[]);var z=(0,j.T)(),O=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(s){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("submit data",s),W||F(!0),n){e.next=10;break}return C(!0),e.next=6,G(s.message);case 6:C(!1),i&&setTimeout((function(){console.log("cliked!"),i.click()}),300),e.next=14;break;case 10:return C(!0),e.next=13,r(s.message);case 13:C(!1);case 14:V&&(V.value=""),x("message","",{shouldValidate:!0});case 16:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){console.log("curr value or ismessageEdit changed",V,n),V&&n&&V.focus()}),[n]),(0,a.useEffect)((function(){x("message",o||"")}),[o]);var G=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:(null===s||void 0===s?void 0:s.uid)||"undefined",displayName:"".concat(null===L||void 0===L?void 0:L.surname," ").concat(null===L||void 0===L?void 0:L.name)||"\u0410\u043d\u043e\u043d\u0456\u043c",photoUrl:(null===L||void 0===L?void 0:L.avatarUrl)||"",text:n,createdAt:(0,_e.Bt)(),id:(0,pe.Z)(),usersWhoRead:[(null===s||void 0===s?void 0:s.uid)||null],edited:!1,received:!1},_(),e.next=4,z((0,M.bG)(t));case 4:V&&(V.value="");case 5:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){if(q.current){var e=q.current.offsetHeight;console.log("formHeight",e),z((0,Ne.aF)(e))}}),[]),(0,a.useEffect)((function(){W||(console.log("trigger"),p("message"))}),[Z("message")]);var P=E&&!n?!E:!!n||!v.message;return(0,w.jsx)("form",{className:he.NewMessageForm,onSubmit:h(O),ref:q,children:(0,w.jsx)(xe.Qr,{name:"message",control:m,rules:{required:"\u041d\u0430\u043f\u0438\u0448\u0456\u0442\u044c \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f!",minLength:{value:1,message:"\u041d\u0430\u043f\u0438\u0448\u0456\u0442\u044c \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f!"},maxLength:{value:600,message:"\u041f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u043d\u0430\u0434\u0442\u043e \u0434\u043e\u0432\u0433\u0435"}},defaultValue:o,render:function(e){var s=e.field,n=s.onChange,t=s.value;return(0,w.jsx)(Ze.Z,{className:he.textareaWrap,children:(0,w.jsx)(je.Z,{value:t,defaultValue:o,onChange:function(e){n(e),E&&B(!1)},component:Ze.Z,placeholder:"\u0412\u0430\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",size:"lg",ref:A,sx:{minWidth:"100%"},endDecorator:P&&(0,w.jsx)(Me.ZP,{color:"primary",type:"submit",className:he.sendBtn,children:(0,w.jsx)(ve.Z,{})})})})}})})})),De=n(54423),Ce="ScrollBottomBtn_ScrollBottomBtn__GScVs",Se="ScrollBottomBtn__hidden__+f-Ia",ye="ScrollBottomBtn_arrow__h1LUK",Re="ScrollBottomBtn_unreadCount__FhPX2",be="ScrollBottomBtn_icon__60NNc",Ee=a.forwardRef((function(e,s){var n=e.element,o=e.unreadCount,r=document.body,i=r.scrollHeight+r.clientHeight,c=r.scrollHeight-(n.scrollTop+n.clientHeight),l=(0,a.useState)(c<100),u=(0,t.Z)(l,2),d=u[0],g=u[1],m=(0,a.useState)(!1),f=(0,t.Z)(m,2),v=f[0],h=f[1],_=(0,a.useState)(i),x=(0,t.Z)(_,2),p=x[0],Z=x[1];(0,a.useEffect)((function(){var e=(0,ue.debounce)((function(e){var s=window.scrollY,n=r.scrollHeight-(s+r.clientHeight)<100;g(n),console.log("is in bottom",n,"is showing:",v),s<p&&!n?h(!0):s>p&&h(!1),Z(s)}),20);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[n]);return(0,w.jsx)("div",{className:"".concat(Ce," ").concat(d&&!v?Se:""),children:(0,w.jsxs)("button",{ref:s,className:ye,onClick:function(){!function(e,s){console.log("scrolll elmenet to bottom",s);var n=0;s||(n=e.scrollHeight-e.clientHeight),e.scrollTo({behavior:"smooth",top:s||n})}(n,i),window.scrollTo({top:i}),console.log("clicked")},children:[o>0&&(0,w.jsx)("div",{className:Re,children:o}),(0,w.jsx)(De.Z,{className:be})]})})})),Be=function(){var e=(0,a.useContext)(i.f).auth,s=(0,o.F_)(e),n=(0,t.Z)(s,1)[0],c=(0,d.v9)(m),l=(0,d.v9)(g.Vi),u=(0,a.useState)(!1),f=(0,t.Z)(u,2),v=f[0],_=f[1],x=(0,a.useState)(null),p=(0,t.Z)(x,2),Z=p[0],N=p[1],D=(0,a.useState)(!0),C=(0,t.Z)(D,2),S=C[0],y=(C[1],(0,a.useState)(null)),R=(0,t.Z)(y,2),b=R[0],E=R[1],B=(0,a.useRef)(null),U=(0,a.useRef)(null);console.log("edit message data",Z);var k=(0,j.T)(),W=function(){_(!1),N(null)};return(0,a.useEffect)((function(){k((0,M.HA)())}),[]),(0,a.useEffect)((function(){var e=null===c||void 0===c?void 0:c.filter((function(e){return!!e.usersWhoRead&&!e.usersWhoRead.includes((null===l||void 0===l?void 0:l.uid)||null)})).length;E(e||null),console.log("unread count",e)}),[null===c||void 0===c?void 0:c.length]),S&&!c?(0,w.jsx)(h.Z,{}):n?(0,w.jsxs)("div",{className:fe,ref:U,children:[c?(0,w.jsx)(me,{ref:B,messagesData:c,setEditMessageData:function(e){N(e),_(!0),console.log("set edit message data",e)},cancelEdit:W}):(0,w.jsx)("div",{children:"\u041d\u0435\u043c\u0430\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c"}),U.current&&(0,w.jsx)(Ee,{element:U.current,ref:B,unreadCount:b||0}),(0,w.jsx)(we,{authData:n,scrollBottomBtn:B.current,isMessageEdit:v,updateMessage:function(e){null!==Z&&void 0!==Z&&Z.id&&(W(),k((0,M.Hd)(Z.id,e)))},currValue:null===Z||void 0===Z?void 0:Z.value})]}):(0,w.jsx)(r.Fg,{to:"/login",replace:!0})}},38693:function(e,s,n){n.d(s,{v:function(){return t}});var t=function(e){return e<10?"0".concat(e):e}}}]);
//# sourceMappingURL=519.3e07bc79.chunk.js.map