"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[535],{8535:function(e,s,a){a.r(s),a.d(s,{default:function(){return ce}});var t=a(29439),n=a(72791),r=a(76910),o=a(16871),c=a(23585),i=a(74165),l=a(15861),u=a(93433),d=a(59434),m=a(44019),f=function(e){return e.messages.messagesData},g=function(e){return e.messages.isFetching},v=function(e){return e.messages.currMessageWhoReadList},h=a(84086),_=a(54423),x=a(763),p="ScrollBottomBtn_ScrollBottomBtn__GScVs",M="ScrollBottomBtn__hidden__+f-Ia",j="ScrollBottomBtn_arrow__h1LUK",Z="ScrollBottomBtn_unreadCount__FhPX2",N="ScrollBottomBtn_icon__60NNc",y=a(80184),w=n.forwardRef((function(e,s){var a=e.element,r=e.unreadCount,o=a.scrollHeight-a.clientHeight,c=a.scrollHeight-(a.scrollTop+a.clientHeight),i=(0,n.useState)(c<100),l=(0,t.Z)(i,2),u=l[0],d=l[1],m=(0,n.useState)(!1),f=(0,t.Z)(m,2),g=f[0],v=f[1],h=o;a.addEventListener("scroll",(0,x.debounce)((function(e){var s=a.scrollTop,t=a.scrollHeight-(a.scrollTop+a.clientHeight)<100;d(t),s<h&&!t?v(!0):s>h&&v(!1),h=a.scrollTop}),20));return(0,y.jsx)("div",{className:"".concat(p," ").concat(u&&!g?M:""),children:(0,y.jsxs)("button",{ref:s,className:j,onClick:function(){return function(e,s){console.log("scrolll elmenet to bottom",s);var a=0;s||(a=e.scrollHeight-e.clientHeight),e.scrollTo({behavior:"smooth",top:s||a})}(a,o)},children:[r>0&&(0,y.jsx)("div",{className:Z,children:r}),(0,y.jsx)(_.Z,{className:N})]})})})),D=a(97788),S=a(17890),k=a(77160),C=a(68944),B={container:"Message_container__98ggQ",Message:"Message_Message__F164D",_my:"Message__my__ylldE",avatar:"Message_avatar__Caopz",messageBody:"Message_messageBody__OUWWq",username:"Message_username__fxinM",text:"Message_text__WoS5w",info:"Message_info__RJA5K",createDate:"Message_createDate__xMQe3",receivedStatus:"Message_receivedStatus__bfpZ1",icon:"Message_icon__heZ9C",edited:"Message_edited__g3pCJ"},R=a(38693),b=a(19348),T=a(79817),E=a(56881),U=D.Z.Text,F=function(e){var s=e.showDeleteConfirm,a=e.className,t=e.messageId;return(0,y.jsx)(U,{onClick:function(){return s(t)},type:"danger",className:a,children:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438"})},W=D.Z.Text,H=function(e){var s=e.messageData,a=e.myAccountId,t=e.showDeleteConfirm,n=e.setEditMessageData,r=e.openInfoModal,o=e.isShort,c=s.text,i=(s.photoUrl,s.uid),l=s.id,u=s.usersWhoRead,d=s.createdAt,m=s.displayName,f=s.received,g=s.edited,v=(0,b.YD)({threshold:.7}),h=v.ref,_=v.inView,x=(v.entry,(0,T.T)());_&&!u.includes(a)&&x((0,E.RC)(l,a));var p=i===a,M=1e3*(null===d||void 0===d?void 0:d.seconds),j=new Date(M||(new Date).getTime()),Z="".concat((0,R.v)(j.getHours()),":").concat((0,R.v)(j.getMinutes())),N=(0,y.jsx)(S.Z,{className:B.contextMenu,items:[{label:(0,y.jsx)(W,{onClick:function(){return n({value:c,id:l})},children:"\u0417\u043c\u0456\u043d\u0438\u0442\u0438"}),key:"1"},{label:(0,y.jsx)(W,{onClick:function(){return r(u)},children:"\u0406\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0456\u044f"}),key:"3"},{label:(0,y.jsx)(F,{className:B.deleteMessage,showDeleteConfirm:t,messageId:s.id}),key:"2"}]});return(0,y.jsx)("div",{className:"".concat(B.Message," ").concat(p&&B._my),ref:h,children:(0,y.jsx)(k.Z,{overlay:N,trigger:["contextMenu","click"],children:(0,y.jsxs)("div",{className:B.messageBody,children:[!o&&!p&&(0,y.jsx)("h5",{className:B.username,children:m}),(0,y.jsx)("p",{className:B.text,children:c}),(0,y.jsxs)("div",{className:B.info,children:[(0,y.jsx)("p",{className:B.createDate,children:Z}),p&&(0,y.jsx)("p",{className:B.receivedStatus,children:f?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(C.Z,{className:B.icon}),(0,y.jsx)(C.Z,{className:B.icon})]}):(0,y.jsx)(C.Z,{className:B.icon})}),g&&(0,y.jsx)("p",{className:B.edited,children:"\u0417\u043c\u0456\u043d\u0435\u043d\u043e"})]})]})})})},A="Messages_Messages__9VokZ",I="Messages_messagesDate__8PYdw",V=a(35796),q=a(14508),L=a(65873),z={container:"ReadMessageUser_container__tq+2i",ReadMessageUser:"ReadMessageUser_ReadMessageUser__Xtepz",name:"ReadMessageUser_name__tWFva"},P=a(23346),K=a(29529),O=function(e){var s=e.userData,a=s.name,t=s.surname,n=s.avatarUrl;return(0,y.jsxs)("div",{className:z.ReadMessageUser,children:[(0,y.jsx)(P.Z,{className:z.avatar,src:n,icon:(0,y.jsx)(K.Z,{}),size:50}),(0,y.jsxs)("p",{className:z.name,children:[a," ",t]})]})},Q=function(e){e.metadata;var s=e.children;e.listRef;return(0,y.jsx)("div",{children:s})},G=n.forwardRef((function(e,s){var a,r,o=e.setEditMessageData,c=(0,d.v9)(f),_=(0,d.v9)(g),x=(0,d.v9)(m.pT),p=(0,n.useState)(null),M=(0,t.Z)(p,2),j=M[0],Z=M[1],N=(0,d.v9)(v),D=(0,n.useState)(!1),S=(0,t.Z)(D,2),k=(S[0],S[1]),C=(0,n.useRef)(null),B=(0,T.T)(),R=function(e){(0,q.ZP)({title:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",icon:(0,y.jsx)(V.Z,{}),content:"\u0412\u0438 \u0434\u0456\u0439\u0441\u043d\u043e \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u0446\u0435 \u043f\u043e\u0432\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f?",okText:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438",okType:"danger",cancelText:"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438",onOk:function(){B((0,E.$Z)(e))},onCancel:function(){console.log("Cancel")}})},b={};null===c||void 0===c||c.forEach((function(e){var s,a=1e3*(null===(s=e.createdAt)||void 0===s?void 0:s.seconds),t=new Date(a||(new Date).getTime()).toLocaleDateString();b[t]||(b[t]=[]),b[t].push(e)}));var U=null===c||void 0===c?void 0:c.filter((function(e){return!!e.usersWhoRead&&!e.usersWhoRead.includes((null===x||void 0===x?void 0:x.uid)||null)})).length,F=null;if(c){var W=[];Object.keys(b).forEach((function(e){var s,a=-1,t=[];b[e].map((function(s,n){var r=(n>0?b[e][n-1].uid:null)==s.uid,c=s.uid===(null===x||void 0===x?void 0:x.uid)||null,i=(0,y.jsx)(H,{messageData:s,myAccountId:(null===x||void 0===x?void 0:x.uid)||"",setEditMessageData:o,showDeleteConfirm:R,openInfoModal:Z,isShort:r},"".concat(s.createdAt).concat(s.uid));r?t[a].messages.push(i):(c?t.push({messages:[i],metadata:{isMy:!0}}):(t.push({messages:[],metadata:{isMy:!1,avatarData:{photoUrl:s.photoUrl,uid:s.uid}}}),t[a+1].messages.push(i)),a++)})),s=t.map((function(e){return(0,y.jsx)(Q,{metadata:e.metadata,listRef:C,children:e.messages})}));var n=[(0,y.jsx)("div",{className:I,children:e})].concat((0,u.Z)(s));W=[].concat((0,u.Z)(W),(0,u.Z)(n))})),F=W}(0,n.useEffect)((function(){var e=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=5;break}return k(!0),e.next=4,B((0,E.Zi)(j));case 4:k(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[j]);var z=[];console.log("users that read mesage",N),N&&N.forEach((function(e){z.push((0,y.jsx)(O,{userData:e}))}));return(0,y.jsxs)("div",{className:A,ref:C,children:[_&&(0,y.jsx)(h.Z,{}),(0,y.jsx)(L.Z,{title:"\u041f\u0435\u0440\u0435\u0433\u043b\u044f\u043d\u0443\u043b\u0438",open:!!j,onCancel:function(){Z(null)},footer:null,children:z||"\u0412\u0430\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f \u043d\u0456\u0445\u0442\u043e \u043d\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0432"}),null!==(a=F)&&void 0!==a&&a.length?F:(0,y.jsx)("div",{children:"\u041d\u0435\u043c\u0430\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c"}),C.current&&!(null===(r=F)||void 0===r||!r.length)&&(0,y.jsx)(w,{element:C.current,ref:s,unreadCount:U||0})]})})),J=G,X="Chat_Chat__qtwg3",Y=a(21686),$={container:"NewMessageForm_container__uLUsq",NewMessageForm:"NewMessageForm_NewMessageForm__yn-Kq",textareaWrap:"NewMessageForm_textareaWrap__2SAy-"},ee=a(9062),se=a(61134),ae=a(62902),te=a(29784),ne=a(25370),re=a(97310),oe=n.memo((function(e){var s=e.authData,a=e.isMessageEdit,r=e.currValue,o=e.updateMessage,c=e.scrollBottomBtn,u=(0,se.cI)(),f=u.control,g=(u.formState.errors,u.handleSubmit),v=u.reset,h=u.setValue,_=(0,n.useState)(!1),x=(0,t.Z)(_,2),p=(x[0],x[1]),M=(0,d.v9)(m.Vi),j=(0,n.useRef)(null),Z=null;(0,n.useEffect)((function(){var e;j&&(Z=null===(e=j.current)||void 0===e?void 0:e.querySelector("textarea"))}),[j]),console.log("message ref",j);var N=(0,T.T)(),w=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(s){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("submit data",s),a){e.next=9;break}return p(!0),e.next=5,D(s.message);case 5:p(!1),c&&setTimeout((function(){console.log("cliked!"),c.click()}),300),e.next=13;break;case 9:return p(!0),e.next=12,o(s.message);case 12:p(!1);case 13:v();case 14:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){Z&&a&&Z.focus(),h("message",r||"")}),[r]);var D=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(a){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:(null===s||void 0===s?void 0:s.uid)||"undefined",displayName:"".concat(null===M||void 0===M?void 0:M.surname," ").concat(null===M||void 0===M?void 0:M.name)||"\u0410\u043d\u043e\u043d\u0456\u043c",photoUrl:(null===M||void 0===M?void 0:M.avatarUrl)||"",text:a,createdAt:(0,ee.Bt)(),id:(0,ae.Z)(),usersWhoRead:[(null===s||void 0===s?void 0:s.uid)||null],edited:!1,received:!1},v(),e.next=4,N((0,E.bG)(t));case 4:Z&&(Z.value="");case 5:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();return(0,y.jsx)("form",{className:$.NewMessageForm,onSubmit:g(w),children:(0,y.jsx)(se.Qr,{name:"message",control:f,defaultValue:r,render:function(e){var s=e.field,a=s.onChange,t=s.value;return(0,y.jsx)(te.Z,{className:$.textareaWrap,children:(0,y.jsx)(ne.Z,{value:t,onChange:a,component:te.Z,placeholder:"\u0412\u0430\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",size:"lg",ref:j,sx:{minWidth:"100%"},endDecorator:(0,y.jsx)(re.ZP,{color:"primary",type:"submit",className:$.sendBtn,children:(0,y.jsx)(Y.Z,{})})})})}})})})),ce=function(){var e=(0,n.useContext)(c.f).auth,s=(0,r.F_)(e),a=(0,t.Z)(s,1)[0],i=(0,n.useState)(!1),l=(0,t.Z)(i,2),u=l[0],d=l[1],m=(0,n.useState)(void 0),f=(0,t.Z)(m,2),g=f[0],v=f[1],h=(0,n.useRef)(null);console.log("edit message data",g);var _=(0,T.T)();return(0,n.useEffect)((function(){_((0,E.HA)())}),[]),a?(console.log("edit messag data",g),(0,y.jsxs)("div",{className:X,children:[(0,y.jsx)(J,{ref:h,setEditMessageData:function(e){v(e),d(!0),console.log("set edit message data",e)}}),(0,y.jsx)(oe,{authData:a,scrollBottomBtn:h.current,isMessageEdit:u,updateMessage:function(e){null!==g&&void 0!==g&&g.id&&(d(!1),v(void 0),_((0,E.Hd)(g.id,e)))},currValue:null===g||void 0===g?void 0:g.value})]})):(0,y.jsx)(o.Fg,{to:"/login",replace:!0})}},38693:function(e,s,a){a.d(s,{v:function(){return t}});var t=function(e){return e<10?"0".concat(e):e}}}]);
//# sourceMappingURL=535.ecb1a1b8.chunk.js.map